<extend name="Public/base"/>
<block name="main">
    <fieldset class="layui-elem-field">
        <legend>健康知识管理 - {:(isset($detail['id'])?'编辑':'新增')}健康知识</legend>
        <div class="layui-field-box">
            <form class="layui-form" action="" id="health_form">
                <if condition="isset($detail['id'])">
                    <input type="hidden" name="id" value="{$detail['id']}">
                </if>
                <div class="layui-form-item">
                    <label class="layui-form-label"><span style="color:red">*</span> 标题</label>
                    <div class="layui-input-block">
                        <input type="text" name="title" required
                               value="{:(isset($detail['title'])?$detail['title']:'')}" lay-verify="required"
                               placeholder="请输入标题" class="layui-input">
                    </div>
                </div>
                <div class="layui-form-item">
                    <label class="layui-form-label"><span style="color:red">*</span> 知识类型</label>
                    <div class="layui-input-block">
                        <select name="type" lay-verify="">
                            <option value="0">请选择类型</option>
                            <volist name="typelist" id="vo">
                                <option value="{$vo[id]}" {:($detail['type'] == $vo['id']?'selected':'')}>{$vo['typename']}</option>
                            </volist>
                        </select>
                    </div>
                </div>
                <div class="layui-form-item">
                    <label class="layui-form-label">轮播图</label>

                    <input name="file" class="layui-upload-file" type="file">
                    <blockquote class="layui-elem-quote layui-quote-nm" style="margin-top: 10px;">
                        预览图：
                        <div class="layui-upload-list" id="demo2">
                            <volist name="img" id="vo">
                                <dd class="item_img" id="{$key}">
                                    <!-- <div class="operate"><i onclick=UPLOAD_IMG_DEL({$key}) class="close layui-icon"></i></div> -->
                                    <div class="operate">
                                        <i onclick="toleft(this)" class="toleft layui-icon"></i>
                                        <i onclick="toright(this)" class="toright layui-icon"></i>
                                        <i onclick=UPLOAD_IMG_DEL({$key}) class="close layui-icon"></i>
                                    </div>
                                    <img style="width:150px;height:150px;margin-left:5px" src="{$vo}">

                                    <input type="hidden" name="file[{$key}]" value="{$vo}">
                                </dd>
                            </volist>
                        </div>
                    </blockquote>
                </div>
                <style>
                    #demo2 {
                        margin: 10px 0 0 0
                    }

                    #demo2 dd {
                        position: relative;
                        margin: 0 10px 10px 0;
                        float: left
                    }

                    #demo2 .operate {
                        position: absolute;
                        top: 0;
                        right: 0;
                        z-index: 1
                    }

                    #demo2 .operate i {
                        cursor: pointer;
                        background: #2F4056;
                        padding: 2px;
                        line-height: 15px;
                        text-align: center;
                        color: #fff;
                        margin-left: 1px;
                        float: left;
                        filter: alpha(opacity=80);
                        -moz-opacity: .8;
                        -khtml-opacity: .8;
                        opacity: .8
                    }
                </style>

                <div class="layui-form-item">
                    <label class="layui-form-label"><span style="color:red">*</span> 是否隐藏</label>
                    <div class="layui-input-block">

                        <input type="checkbox" name="ifshow" lay-skin="switch" lay-text="下架|上线" {:((isset($detail['ifshow'])
                        && $detail['ifshow']==1)?'checked':'')}>

                    </div>
                </div>
                <div class="layui-form-item layui-form-text">
                    <label class="layui-form-label">发布人</label>
                    <div class="layui-input-block">
                        <input type="text" name="publishname"
                               value="{:(isset($detail['publishname'])?$detail['publishname']:'')}" placeholder="请输入发布人"
                               class="layui-input">
                    </div>
                </div>
                <div class="layui-form-item layui-form-text">
                    <label class="layui-form-label">内容</label>
                    <div class="layui-input-block">
                        <textarea id="editor"
                                  name="content">{:(isset($detail['content'])?$detail['content']:'')}</textarea>
                        <script type="text/javascript" src="__PUBLIC__/ueditor/ueditor.config.js"></script>
                        <script type="text/javascript" src="__PUBLIC__/ueditor/ueditor.all.min.js"></script>
                        <script>
                            var ue = UE.getEditor("editor");

                        </script>
                        <!-- <input type="text" name="content" value="{:(isset($detail['content'])?$detail['content']:'')}" placeholder="请输入内容" class="layui-input">  -->
                    </div>
                </div>
                <div class="layui-form-item">
                    <div class="layui-input-block">
                        <button class="layui-btn" lay-submit lay-filter="admin-form">立即提交</button>
                        <button type="reset" class="layui-btn layui-btn-primary">重置</button>
                    </div>
                </div>
            </form>
        </div>
    </fieldset>
</block>
<block name="myScript">
    <script>
        layui.use('upload', function () {
            layui.upload({
                url: '{:U("upload")}' //上传接口
                , success: function (res) { //上传成功后的回调
                    // alert(res);
                    var l = $("img").length;
                    img = res;

                    var html = '<dd class="item_img" id="' + img.imgid + '">'
                        + '<div class="operate"><i onclick=UPLOAD_IMG_DEL(' + img.imgid + ') class="close layui-icon"></i><i onclick="toleft(this)" class="toleft layui-icon"></i><i onclick="toright(this)" class="toright layui-icon"></i></div>'
                        + '<img style="margin-left:5px;width:150px;height:150px" src="' + img.url + '" /><input type="hidden" name="file[' + img.imgid + ']" value="' + img.url + '">';

                    $('#demo2').append(html);
                }
            });


        });

        /*
        删除上传图片
        */
        function UPLOAD_IMG_DEL(divs) {
            $("#" + divs).remove();
        }

        /*
        多图上传变换左右位置
        */
        function toleft(obj) {
            //alert(1);
            var item = $(obj).parent().parent(".item_img");
            var item_left = item.prev(".item_img");
            if ($("#demo2").children(".item_img").length >= 2) {
                if (item_left.length == 0) {
                    item.insertAfter($("#demo2").children(".item_img:last"))
                } else {
                    item.insertBefore(item_left)
                }
            }
        }

        function toright(obj) {
            var item = $(obj).parent().parent(".item_img");
            var item_right = item.next(".item_img");
            if ($("#demo2").children(".item_img").length >= 2) {
                if (item_right.length == 0) {
                    item.insertBefore($("#demo2").children(".item_img:first"))
                } else {
                    item.insertAfter(item_right)
                }
            }
        }
    </script>
    <if condition="isset($detail['id'])">
        <script>
            layui.use('form', function () {
                var form = layui.form();
                form.on('submit(admin-form)', function (data) {
                    //alert(data.field);
                    $.ajax({
                        type: "POST",
                        url: '{:U("edit")}',
                        data: data.field,
                        success: function (msg) {
                            //alert(msg);return false;
                            if (msg.code == 1) {
                                parent.location.reload();
                            } else {
                                parent.layer.msg(msg.msg, {
                                    icon: 5,
                                    shade: [0.6, '#393D49'],
                                    time: 1500
                                });
                            }
                        }
                    });
                    return false;
                });

            });
        </script>
        <else/>
        <script>
            layui.use('form', function () {
                var form = layui.form();
                form.on('submit(admin-form)', function (data) {
                    $.ajax({
                        type: "POST",
                        url: '{:U("add")}',
                        data: data.field,
                        success: function (msg) {
                            //alert(msg);
                            if (msg.code == 1) {
                                parent.location.reload();
                            } else {
                                parent.layer.msg(msg.msg, {
                                    icon: 5,
                                    shade: [0.6, '#393D49'],
                                    time: 1500
                                });
                            }
                        }
                    });
                    return false;
                });

            });
        </script>
    </if>
</block>